

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Conditional Average Treatment Effects (CATE) with DoWhy and EconML &mdash; DoWhy | Making Causal Inference Easy  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> DoWhy | Making Causal Inference Easy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">DoWhy | Making causal inference easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dowhy_simple_example.html">Getting started with DoWhy: A simple example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dowhy_confounder_example.html">Confounding Example: Finding causal effects from observed data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dowhy_estimation_methods.html">DoWhy: Different estimation methods for causal inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dowhy_causal_api.html">Demo for the DoWhy causal API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../load_graph_example.html">Different ways to load an input graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dowhy_ihdp_data_example.html">DoWhy example on ihdp (Infant Health and Development Program) dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dowhy_lalonde_example.html">DoWhy example on the Lalonde dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lalonde_pandas_api.html">Lalonde Pandas API Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../do_sampler_demo.html">Do-sampler Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../code_repo.html">Code repository &amp; Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dowhy.html">dowhy package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">dowhy</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DoWhy | Making Causal Inference Easy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Conditional Average Treatment Effects (CATE) with DoWhy and EconML</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/example_notebooks/.ipynb_checkpoints/dowhy-conditional-treatment-effects-checkpoint.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Conditional-Average-Treatment-Effects-(CATE)-with-DoWhy-and-EconML">
<h1>Conditional Average Treatment Effects (CATE) with DoWhy and EconML<a class="headerlink" href="#Conditional-Average-Treatment-Effects-(CATE)-with-DoWhy-and-EconML" title="Permalink to this headline">¶</a></h1>
<p>This is an experimental feature where we use <a class="reference external" href="https://github.com/microsoft/econml">EconML</a> methods from DoWhy. Using EconML allows CATE estimation using different methods.</p>
<p>All four steps of causal inference in DoWhy remain the same: model, identify, estimate, and refute. The key difference is that we now call econml methods in the estimation step. There is also a simpler example using linear regression to understand the intuition behind CATE estimators.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;../../../&quot;</span><span class="p">))</span>  <span class="c1"># for dowhy source code</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">dowhy</span>
<span class="kn">from</span> <span class="nn">dowhy</span> <span class="kn">import</span> <span class="n">CausalModel</span>
<span class="kn">import</span> <span class="nn">dowhy.datasets</span>

<span class="kn">import</span> <span class="nn">econml</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">dowhy</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">linear_dataset</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">num_common_causes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                                    <span class="n">num_instruments</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_effect_modifiers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                     <span class="n">num_treatments</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">treatment_is_binary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>X0</th>
      <th>X1</th>
      <th>Z0</th>
      <th>Z1</th>
      <th>W0</th>
      <th>W1</th>
      <th>W2</th>
      <th>W3</th>
      <th>v0</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.457977</td>
      <td>0.500976</td>
      <td>1.0</td>
      <td>0.129755</td>
      <td>-0.247620</td>
      <td>-1.983959</td>
      <td>-2.153729</td>
      <td>2.010410</td>
      <td>3.244760</td>
      <td>29.903597</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.806961</td>
      <td>0.106257</td>
      <td>0.0</td>
      <td>0.400526</td>
      <td>-0.391759</td>
      <td>-1.108265</td>
      <td>1.165349</td>
      <td>0.164691</td>
      <td>5.022824</td>
      <td>34.917521</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-1.558373</td>
      <td>-0.341299</td>
      <td>1.0</td>
      <td>0.477801</td>
      <td>-0.488273</td>
      <td>1.778429</td>
      <td>-1.358026</td>
      <td>0.041389</td>
      <td>1.685465</td>
      <td>8.915996</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.283642</td>
      <td>1.043216</td>
      <td>1.0</td>
      <td>0.564742</td>
      <td>1.408603</td>
      <td>-1.897429</td>
      <td>-0.596991</td>
      <td>2.001279</td>
      <td>14.818945</td>
      <td>132.023507</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.298940</td>
      <td>-0.461621</td>
      <td>0.0</td>
      <td>0.871755</td>
      <td>-0.909621</td>
      <td>-0.483217</td>
      <td>-0.888641</td>
      <td>0.654469</td>
      <td>0.629426</td>
      <td>-0.102922</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">CausalModel</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">],</span>
                    <span class="n">treatment</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;treatment_name&quot;</span><span class="p">],</span> <span class="n">outcome</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;outcome_name&quot;</span><span class="p">],</span>
                    <span class="n">graph</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;gml_graph&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_model:Model to find the causal effect of treatment [&#39;v0&#39;] on outcome [&#39;y&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span><span class="o">.</span><span class="n">view_model</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>
<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;causal_model.png&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/example_notebooks_.ipynb_checkpoints_dowhy-conditional-treatment-effects-checkpoint_5_0.png" src="../../_images/example_notebooks_.ipynb_checkpoints_dowhy-conditional-treatment-effects-checkpoint_5_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">identified_estimand</span><span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">identify_effect</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_identifier:Common causes of treatment and outcome:[&#39;W1&#39;, &#39;Unobserved Confounders&#39;, &#39;W2&#39;, &#39;W0&#39;, &#39;W3&#39;]
WARNING:dowhy.causal_identifier:If this is observed data (not from a randomized experiment), there might always be missing confounders. Causal effect cannot be identified perfectly.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARN: Do you want to continue by ignoring any unobserved confounders? (use proceed_when_unidentifiable=True to disable this prompt) [y/n] y
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_identifier:Instrumental variables for treatment and outcome:[&#39;Z1&#39;, &#39;Z0&#39;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimand type: nonparametric-ate
### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|W1,W2,W0,W3))
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W1,W2,W0,W3,U) = P(y|v0,W1,W2,W0,W3)
### Estimand : 2
Estimand name: iv
Estimand expression:
Expectation(Derivative(y, [Z1, Z0])*Derivative([v0], [Z1, Z0])**(-1))
Estimand assumption 1, As-if-random: If U→→y then ¬(U →→{Z1,Z0})
Estimand assumption 2, Exclusion: If we remove {Z1,Z0}→{v0}, then ¬({Z1,Z0}→y)

</pre></div></div>
</div>
</div>
<div class="section" id="Linear-Model">
<h1>Linear Model<a class="headerlink" href="#Linear-Model" title="Permalink to this headline">¶</a></h1>
<p>First, let us build some intuition using a linear model for estimating CATE. The effect modifiers (that lead to a heterogeneous treatment effect) can be modeled as interaction terms with the treatment. Thus, their value modulates the effect of treatment.</p>
<p>Below the estimated effect of changing treatment from 0 to 1.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">linear_estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">,</span>
                                        <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;backdoor.linear_regression&quot;</span><span class="p">,</span>
                                       <span class="n">control_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                       <span class="n">treatment_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">linear_estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_estimator:INFO: Using Linear Regression Estimator
INFO:dowhy.causal_estimator:b: y~v0+W1+W2+W0+W3+v0*X0+v0*X1
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Target estimand
Estimand type: nonparametric-ate
### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|W1,W2,W0,W3))
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W1,W2,W0,W3,U) = P(y|v0,W1,W2,W0,W3)
### Estimand : 2
Estimand name: iv
Estimand expression:
Expectation(Derivative(y, [Z1, Z0])*Derivative([v0], [Z1, Z0])**(-1))
Estimand assumption 1, As-if-random: If U→→y then ¬(U →→{Z1,Z0})
Estimand assumption 2, Exclusion: If we remove {Z1,Z0}→{v0}, then ¬({Z1,Z0}→y)

## Realized estimand
b: y~v0+W1+W2+W0+W3+v0*X0+v0*X1
## Estimate
Value: 10.000000000000004

</pre></div></div>
</div>
</div>
<div class="section" id="EconML-methods">
<h1>EconML methods<a class="headerlink" href="#EconML-methods" title="Permalink to this headline">¶</a></h1>
<p>We now move to the more advanced methods from the EconML package for estimating CATE.</p>
<p>First, let us look at the double machine learning estimator. Method_name corresponds to the fully qualified name of the class that we want to use. For double ML, it is “econml.dml.DMLCateEstimator”.</p>
<p>Target units defines the units over which the causal estimate is to be computed. This can be a lambda function filter on the original dataframe, a new Pandas dataframe, or a string corresponding to the three main kinds of target units (“ate”, “att” and “atc”). Below we show an example of a lambda function.</p>
<p>Method_params are passed directly to EconML. For details on allowed parameters, refer to the EconML documentation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
<span class="n">dml_estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;backdoor.econml.dml.DMLCateEstimator&quot;</span><span class="p">,</span>
                                     <span class="n">control_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                     <span class="n">treatment_value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                 <span class="n">target_units</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;X0&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># condition used for CATE</span>
                                 <span class="n">confidence_intervals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;init_params&quot;</span><span class="p">:{</span><span class="s1">&#39;model_y&#39;</span><span class="p">:</span><span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
                                                              <span class="s1">&#39;model_t&#39;</span><span class="p">:</span> <span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
                                                              <span class="s2">&quot;model_final&quot;</span><span class="p">:</span><span class="n">LassoCV</span><span class="p">(),</span>
                                                              <span class="s1">&#39;featurizer&#39;</span><span class="p">:</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
                                               <span class="s2">&quot;fit_params&quot;</span><span class="p">:{}})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_estimator:INFO: Using EconML Estimator
INFO:dowhy.causal_estimator:b: y~v0+W1+W2+W0+W3
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Target estimand
Estimand type: nonparametric-ate
### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|W1,W2,W0,W3))
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W1,W2,W0,W3,U) = P(y|v0,W1,W2,W0,W3)
### Estimand : 2
Estimand name: iv
Estimand expression:
Expectation(Derivative(y, [Z1, Z0])*Derivative([v0], [Z1, Z0])**(-1))
Estimand assumption 1, As-if-random: If U→→y then ¬(U →→{Z1,Z0})
Estimand assumption 2, Exclusion: If we remove {Z1,Z0}→{v0}, then ¬({Z1,Z0}→y)

## Realized estimand
b: y~v0+W1+W2+W0+W3
## Estimate
Value: 13.064869871583577

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True causal estimate is&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;ate&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
True causal estimate is 8.771238055594218
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dml_estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;backdoor.econml.dml.DMLCateEstimator&quot;</span><span class="p">,</span>
                                     <span class="n">control_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                     <span class="n">treatment_value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                 <span class="n">target_units</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># condition used for CATE</span>
                                 <span class="n">confidence_intervals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;init_params&quot;</span><span class="p">:{</span><span class="s1">&#39;model_y&#39;</span><span class="p">:</span><span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
                                                              <span class="s1">&#39;model_t&#39;</span><span class="p">:</span> <span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
                                                              <span class="s2">&quot;model_final&quot;</span><span class="p">:</span><span class="n">LassoCV</span><span class="p">(),</span>
                                                              <span class="s1">&#39;featurizer&#39;</span><span class="p">:</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
                                               <span class="s2">&quot;fit_params&quot;</span><span class="p">:{}})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_estimator:INFO: Using EconML Estimator
INFO:dowhy.causal_estimator:b: y~v0+W1+W2+W0+W3
</pre></div></div>
</div>
<div class="section" id="CATE-Object-and-Confidence-Intervals">
<h2>CATE Object and Confidence Intervals<a class="headerlink" href="#CATE-Object-and-Confidence-Intervals" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
<span class="n">dml_estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">,</span>
                                     <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;backdoor.econml.dml.DMLCateEstimator&quot;</span><span class="p">,</span>
                                     <span class="n">target_units</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;X0&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">,</span>
                                     <span class="n">confidence_intervals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                     <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;init_params&quot;</span><span class="p">:{</span><span class="s1">&#39;model_y&#39;</span><span class="p">:</span><span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
                                                              <span class="s1">&#39;model_t&#39;</span><span class="p">:</span> <span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
                                                              <span class="s2">&quot;model_final&quot;</span><span class="p">:</span><span class="n">LassoCV</span><span class="p">(),</span>
                                                              <span class="s1">&#39;featurizer&#39;</span><span class="p">:</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
                                               <span class="s2">&quot;fit_params&quot;</span><span class="p">:{</span>
                                                               <span class="s1">&#39;inference&#39;</span><span class="p">:</span> <span class="s1">&#39;bootstrap&#39;</span><span class="p">,</span>
                                                            <span class="p">}</span>
                                              <span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_estimate</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_estimate</span><span class="o">.</span><span class="n">cate_estimates</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_estimate</span><span class="o">.</span><span class="n">effect_intervals</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_estimator:INFO: Using EconML Estimator
INFO:dowhy.causal_estimator:b: y~v0+W1+W2+W0+W3
[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 32 concurrent workers.
[Parallel(n_jobs=-1)]: Done  71 out of 100 | elapsed:  1.1min remaining:   27.3s
[Parallel(n_jobs=-1)]: Done 100 out of 100 | elapsed:  1.2min finished
[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 32 concurrent workers.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Target estimand
Estimand type: nonparametric-ate
### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|W1,W2,W0,W3))
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W1,W2,W0,W3,U) = P(y|v0,W1,W2,W0,W3)
### Estimand : 2
Estimand name: iv
Estimand expression:
Expectation(Derivative(y, [Z1, Z0])*Derivative([v0], [Z1, Z0])**(-1))
Estimand assumption 1, As-if-random: If U→→y then ¬(U →→{Z1,Z0})
Estimand assumption 2, Exclusion: If we remove {Z1,Z0}→{v0}, then ¬({Z1,Z0}→y)

## Realized estimand
b: y~v0+W1+W2+W0+W3
## Estimate
Value: 13.185324409635838

[[13.34811664]
 [11.82392442]
 [13.4324349 ]
 [13.89951208]
 [12.91939375]
 [12.57049536]
 [14.32650549]
 [14.78769963]
 [12.09729888]
 [ 9.47518158]]
(array([[12.83757602],
       [11.36148104],
       [12.94550782],
       [13.35815038],
       [12.36856097],
       [12.06303541],
       [13.78173184],
       [14.19639791],
       [11.63011965],
       [ 9.02407493],
       [ 9.9528654 ],
       [12.08311578],
       [12.78877618],
       [15.00705717],
       [12.50713405],
       [10.32046134],
       [13.16287988],
       [10.98811338],
       [13.78357532],
       [13.72373731],
       [13.92911998],
       [12.05347319],
       [12.3366888 ],
       [13.71259094],
       [10.93936947],
       [10.67026233],
       [12.91711418],
       [12.58819731],
       [14.18885778],
       [13.66373605],
       [11.7156474 ],
       [11.18633787],
       [12.779337  ],
       [11.46212154],
       [11.36219328],
       [12.56920972],
       [13.86584425],
       [10.7813739 ],
       [12.18198908],
       [11.90258062],
       [10.9843221 ],
       [12.43502368],
       [14.20266931],
       [11.38871025],
       [12.57953176],
       [11.42237698],
       [12.98350746],
       [12.5478464 ],
       [11.34142044],
       [11.30255504],
       [14.33945402],
       [12.48381814],
       [15.7208454 ],
       [14.70582818],
       [10.62888673],
       [13.89120506],
       [12.32167719],
       [15.31297089],
       [ 9.76865427],
       [11.91191579],
       [11.96947938],
       [13.55699228],
       [13.11432886],
       [13.63593527],
       [13.26624609],
       [15.50071681],
       [11.67339056],
       [14.01863449],
       [12.25192912],
       [13.94047777],
       [13.51618395],
       [11.75418626],
       [13.24108418],
       [11.63411998],
       [11.46280859],
       [14.1898521 ],
       [13.97851331],
       [16.01160098],
       [11.37167557],
       [11.70826654],
       [14.27564233],
       [12.85534766],
       [11.73783005],
       [12.81968567],
       [11.93281395],
       [12.67478698],
       [12.05157869],
       [13.53354962],
       [12.54187006],
       [14.29764789],
       [11.92037664],
       [15.20604251],
       [13.27458055],
       [10.71494595],
       [13.29531138],
       [15.03362559],
       [12.24026138],
       [12.50744886],
       [14.95526724],
       [13.35344483],
       [13.29774604],
       [13.80852643],
       [11.57722411],
       [14.80875889],
       [11.82715731],
       [14.55447286],
       [15.31301708],
       [13.77506407],
       [12.3492211 ],
       [11.79390219],
       [12.52611414],
       [11.84290656],
       [13.04706897],
       [16.80310546],
       [12.10155411],
       [13.13672984],
       [11.84189352],
       [11.2989842 ],
       [11.69029026],
       [12.94050446],
       [12.41954644],
       [11.76840963],
       [12.12353232],
       [12.40856392],
       [11.1247263 ],
       [13.1262996 ],
       [12.60772201],
       [14.26449891],
       [11.77352696],
       [13.19537851],
       [11.45590221],
       [14.72059794],
       [13.92391431],
       [12.23708875],
       [12.25931713],
       [13.23983862],
       [13.51019848],
       [12.10674142],
       [14.23797634],
       [11.52041715],
       [13.50169581],
       [12.03644497],
       [10.9701239 ],
       [12.23655068],
       [12.52121082],
       [13.42023523],
       [12.88877949],
       [10.10306272],
       [15.02760424],
       [12.4176501 ],
       [10.30100551],
       [12.04351956],
       [12.7463399 ],
       [12.90756878],
       [13.44653275],
       [12.26197408],
       [13.12915164],
       [10.34340298],
       [11.60199101],
       [13.27840611],
       [ 9.92427687],
       [13.50193178],
       [15.55444078],
       [11.7391754 ],
       [14.47484236],
       [14.10457899],
       [13.60956017],
       [11.80260997],
       [11.22699761],
       [13.70472937],
       [12.95340077],
       [13.40242594],
       [12.70221482],
       [14.8878631 ],
       [12.92102831],
       [11.13801763],
       [15.14617702],
       [15.41165373],
       [11.67929325],
       [14.49116243],
       [14.23211404],
       [13.01944829],
       [11.82390895],
       [14.37142152],
       [13.23042136],
       [12.82072813],
       [12.42196489],
       [14.58566622],
       [11.03923171],
       [13.86954689],
       [12.97528579],
       [11.12228771],
       [12.30759735],
       [14.34742669],
       [11.1890952 ],
       [13.08509937],
       [10.9476742 ],
       [10.08955455],
       [15.18105838],
       [11.74999943],
       [14.07618478],
       [11.48301549],
       [10.75221699],
       [11.05335085],
       [13.98547094],
       [13.58558429],
       [12.82600867],
       [12.30033211],
       [11.43029004],
       [13.66862221],
       [12.10748306],
       [13.01138991],
       [13.77264881],
       [12.95544812],
       [14.62673198],
       [11.39573442],
       [12.81206941],
       [13.57354043],
       [11.4823133 ],
       [12.78172578],
       [12.79574376],
       [13.27873526],
       [13.373442  ],
       [12.74576668],
       [12.47238357],
       [11.02692452],
       [11.48515274],
       [14.33287441],
       [14.44378846],
       [10.84012937],
       [11.31125955],
       [13.22698984],
       [10.32858174],
       [11.84141587],
       [12.36029018],
       [11.91577786],
       [11.71069935],
       [10.61432175],
       [12.37274041],
       [11.79219918],
       [12.11461104],
       [13.07640593],
       [13.00033353],
       [13.18788949],
       [10.88071443],
       [10.58374222],
       [12.98337133],
       [ 9.54221615],
       [11.31343653],
       [12.10626512],
       [13.48081401],
       [14.33818244],
       [11.47833176],
       [11.55094121]]), array([[13.21309505],
       [11.72783511],
       [13.29051631],
       [13.74504769],
       [12.81614523],
       [12.46323979],
       [14.17091412],
       [14.62586401],
       [11.9941755 ],
       [ 9.55457114],
       [10.4165917 ],
       [12.41313344],
       [13.12387961],
       [15.54038425],
       [12.86402829],
       [10.74989114],
       [13.51822759],
       [11.31739824],
       [14.17584383],
       [14.12379584],
       [14.38385097],
       [12.3809212 ],
       [12.76191056],
       [14.12847565],
       [11.40325274],
       [11.12536492],
       [13.25736415],
       [12.91238645],
       [14.61719517],
       [14.05930109],
       [12.07904814],
       [11.56119268],
       [13.11229156],
       [11.77338357],
       [11.73109037],
       [12.89976691],
       [14.27838244],
       [11.45776391],
       [12.52043176],
       [12.21619349],
       [11.37753792],
       [12.81772733],
       [14.61578296],
       [11.71737689],
       [12.94100652],
       [11.7534712 ],
       [13.34281539],
       [12.94870808],
       [11.67163173],
       [11.62359296],
       [14.76629382],
       [12.80465985],
       [16.24976114],
       [15.22204746],
       [10.98039709],
       [14.31021391],
       [12.67391109],
       [15.81809905],
       [10.20667742],
       [12.22611254],
       [12.28739433],
       [13.97064435],
       [13.46621583],
       [14.02939237],
       [13.6362021 ],
       [16.00746598],
       [12.03306286],
       [14.44127073],
       [12.56865031],
       [14.35613736],
       [13.91541994],
       [12.10599118],
       [13.59870159],
       [11.94463421],
       [11.83895836],
       [14.65298495],
       [14.39986218],
       [16.55576851],
       [11.75794009],
       [12.0265809 ],
       [14.69440994],
       [13.22982214],
       [12.05522595],
       [13.15476869],
       [12.24866206],
       [13.05580077],
       [12.3789074 ],
       [13.93081395],
       [12.86392586],
       [14.78990257],
       [12.2836761 ],
       [15.69613451],
       [13.65163854],
       [11.05425173],
       [13.70727417],
       [15.50470442],
       [12.62859825],
       [12.89887579],
       [15.4396719 ],
       [13.7388126 ],
       [13.68306688],
       [14.21705274],
       [11.92691678],
       [15.3429485 ],
       [12.20277118],
       [15.04744945],
       [15.79873739],
       [14.18957007],
       [12.66200175],
       [12.12629248],
       [12.84882558],
       [12.15132535],
       [13.41300776],
       [17.38673785],
       [12.42725345],
       [13.55210763],
       [12.21694141],
       [11.65071891],
       [12.00674158],
       [13.27907614],
       [12.78008345],
       [12.07374409],
       [12.45724559],
       [12.76013136],
       [11.45252695],
       [13.4776011 ],
       [12.93278042],
       [14.6819097 ],
       [12.20729674],
       [13.59276265],
       [11.78391569],
       [15.23993563],
       [14.32196803],
       [12.56667238],
       [12.6013856 ],
       [13.6088211 ],
       [13.89521666],
       [12.43716067],
       [14.7440684 ],
       [11.86423882],
       [13.87796661],
       [12.37336174],
       [11.34712062],
       [12.68201966],
       [12.89168981],
       [13.7913886 ],
       [13.22871704],
       [10.62956493],
       [15.57131714],
       [12.73479539],
       [10.72608325],
       [12.37104644],
       [13.13081518],
       [13.30553011],
       [13.81535388],
       [12.60763992],
       [13.48370363],
       [10.78077771],
       [11.95422175],
       [13.65522051],
       [10.4156911 ],
       [13.87462211],
       [16.09824693],
       [12.06201131],
       [14.9118785 ],
       [14.60906458],
       [13.98782917],
       [12.17585843],
       [11.5767367 ],
       [14.09000107],
       [13.29837684],
       [13.77137397],
       [13.16497121],
       [15.36776901],
       [13.2835282 ],
       [11.50386533],
       [15.68548601],
       [15.90101966],
       [12.0046873 ],
       [14.94491396],
       [14.76403926],
       [13.36480966],
       [12.13146914],
       [14.79330801],
       [13.59138092],
       [13.15912572],
       [12.7397246 ],
       [15.10073443],
       [11.37049778],
       [14.26506402],
       [13.35133003],
       [11.52460887],
       [12.64156753],
       [14.82065633],
       [11.60268267],
       [13.45494808],
       [11.2878759 ],
       [10.53607069],
       [15.71772005],
       [12.06906953],
       [14.48623668],
       [11.82290911],
       [11.09872436],
       [11.40042873],
       [14.40946931],
       [13.98713401],
       [13.17264167],
       [12.62629922],
       [11.77683626],
       [14.07259035],
       [12.4599217 ],
       [13.35754402],
       [14.17924272],
       [13.29908228],
       [15.13252592],
       [11.71631682],
       [13.23506999],
       [13.96577009],
       [11.7985128 ],
       [13.24540373],
       [13.1298922 ],
       [13.80623177],
       [13.85119227],
       [13.10072139],
       [12.80780465],
       [11.35310078],
       [11.86949217],
       [14.79380671],
       [14.89656965],
       [11.2324944 ],
       [11.72817693],
       [13.61950932],
       [10.81514982],
       [12.16633409],
       [12.73373505],
       [12.31785208],
       [12.1208253 ],
       [10.96367231],
       [12.77052858],
       [12.12613575],
       [12.44279038],
       [13.54890782],
       [13.34888111],
       [13.54204848],
       [11.26606533],
       [10.93164182],
       [13.32940442],
       [10.00712694],
       [11.72710046],
       [12.43680416],
       [13.86642881],
       [14.78482771],
       [11.80511405],
       [11.94882678]]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[Parallel(n_jobs=-1)]: Done  71 out of 100 | elapsed:    0.1s remaining:    0.0s
[Parallel(n_jobs=-1)]: Done 100 out of 100 | elapsed:    0.1s finished
</pre></div></div>
</div>
</div>
<div class="section" id="Can-provide-a-new-inputs-as-target-units-and-estimate-CATE-on-them.">
<h2>Can provide a new inputs as target units and estimate CATE on them.<a class="headerlink" href="#Can-provide-a-new-inputs-as-target-units-and-estimate-CATE-on-them." title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">test_cols</span><span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;effect_modifier_names&#39;</span><span class="p">]</span> <span class="c1"># only need effect modifiers&#39; values</span>
<span class="n">test_arr</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_cols</span><span class="p">))]</span> <span class="c1"># all variables are sampled uniformly, sample of 10</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">test_arr</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">test_cols</span><span class="p">)</span>
<span class="n">dml_estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">,</span>
                                     <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;backdoor.econml.dml.DMLCateEstimator&quot;</span><span class="p">,</span>
                                     <span class="n">target_units</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">,</span>
                                     <span class="n">confidence_intervals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;init_params&quot;</span><span class="p">:{</span><span class="s1">&#39;model_y&#39;</span><span class="p">:</span><span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
                                                              <span class="s1">&#39;model_t&#39;</span><span class="p">:</span> <span class="n">GradientBoostingRegressor</span><span class="p">(),</span>
                                                              <span class="s2">&quot;model_final&quot;</span><span class="p">:</span><span class="n">LassoCV</span><span class="p">(),</span>
                                                              <span class="s1">&#39;featurizer&#39;</span><span class="p">:</span><span class="n">PolynomialFeatures</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">include_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)},</span>
                                               <span class="s2">&quot;fit_params&quot;</span><span class="p">:{}</span>
                                              <span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dml_estimate</span><span class="o">.</span><span class="n">cate_estimates</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_estimator:INFO: Using EconML Estimator
INFO:dowhy.causal_estimator:b: y~v0+W1+W2+W0+W3
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[11.73915513]
 [10.80752979]
 [11.06007731]
 [12.19118812]
 [11.40340702]
 [10.22817457]
 [11.43498896]
 [10.37353075]
 [11.66177855]
 [12.57559901]]
</pre></div></div>
</div>
</div>
<div class="section" id="Can-also-retrieve-the-raw-EconML-estimator-object-for-any-further-operations">
<h2>Can also retrieve the raw EconML estimator object for any further operations<a class="headerlink" href="#Can-also-retrieve-the-raw-EconML-estimator-object-for-any-further-operations" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">dml_estimate</span><span class="o">.</span><span class="n">_estimator_object</span><span class="p">)</span>
<span class="n">dml_estimate</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;econml.dml.DMLCateEstimator object at 0x7f7edd2167b8&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;dowhy.causal_estimator.CausalEstimate at 0x7f7edd216320&gt;
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Works-with-any-EconML-method">
<h1>Works with any EconML method<a class="headerlink" href="#Works-with-any-EconML-method" title="Permalink to this headline">¶</a></h1>
<p>In addition to double machine learning, below we example analyses using orthogonal forests, DRLearner (bug to fix), and neural network-based instrumental variables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="n">orthoforest_estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;backdoor.econml.ortho_forest.ContinuousTreatmentOrthoForest&quot;</span><span class="p">,</span>
                                 <span class="n">target_units</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;X0&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">,</span>
                                 <span class="n">confidence_intervals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;init_params&quot;</span><span class="p">:{</span>
                                                    <span class="s1">&#39;n_trees&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># not ideal, just as an example to speed up computation</span>
                                                    <span class="p">},</span>
                                               <span class="s2">&quot;fit_params&quot;</span><span class="p">:{}</span>
                                              <span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">orthoforest_estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_estimator:INFO: Using EconML Estimator
INFO:dowhy.causal_estimator:b: y~v0+W1+W2+W0+W3
[Parallel(n_jobs=-1)]: Using backend LokyBackend with 32 concurrent workers.
[Parallel(n_jobs=-1)]: Done   2 out of   2 | elapsed:   35.3s remaining:    0.0s
[Parallel(n_jobs=-1)]: Done   2 out of   2 | elapsed:   35.3s finished
[Parallel(n_jobs=-1)]: Using backend LokyBackend with 32 concurrent workers.
[Parallel(n_jobs=-1)]: Done   2 out of   2 | elapsed:   11.1s remaining:    0.0s
[Parallel(n_jobs=-1)]: Done   2 out of   2 | elapsed:   11.1s finished
[Parallel(n_jobs=-1)]: Using backend ThreadingBackend with 32 concurrent workers.
[Parallel(n_jobs=-1)]: Done  64 tasks      | elapsed:   27.6s
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
*** Causal Estimate ***

## Target estimand
Estimand type: nonparametric-ate
### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|W1,W2,W0,W3))
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W1,W2,W0,W3,U) = P(y|v0,W1,W2,W0,W3)
### Estimand : 2
Estimand name: iv
Estimand expression:
Expectation(Derivative(y, [Z1, Z0])*Derivative([v0], [Z1, Z0])**(-1))
Estimand assumption 1, As-if-random: If U→→y then ¬(U →→{Z1,Z0})
Estimand assumption 2, Exclusion: If we remove {Z1,Z0}→{v0}, then ¬({Z1,Z0}→y)

## Realized estimand
b: y~v0+W1+W2+W0+W3
## Estimate
Value: 12.541554179343002

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[Parallel(n_jobs=-1)]: Done 254 out of 254 | elapsed:  1.6min finished
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data_binary</span> <span class="o">=</span> <span class="n">dowhy</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">linear_dataset</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">num_common_causes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
                                    <span class="n">num_instruments</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_effect_modifiers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                    <span class="n">treatment_is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">outcome_is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_binary</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">])</span>

<span class="n">model_binary</span> <span class="o">=</span> <span class="n">CausalModel</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_binary</span><span class="p">[</span><span class="s2">&quot;df&quot;</span><span class="p">],</span>
                    <span class="n">treatment</span><span class="o">=</span><span class="n">data_binary</span><span class="p">[</span><span class="s2">&quot;treatment_name&quot;</span><span class="p">],</span> <span class="n">outcome</span><span class="o">=</span><span class="n">data_binary</span><span class="p">[</span><span class="s2">&quot;outcome_name&quot;</span><span class="p">],</span>
                    <span class="n">graph</span><span class="o">=</span><span class="n">data_binary</span><span class="p">[</span><span class="s2">&quot;gml_graph&quot;</span><span class="p">])</span>
<span class="n">identified_estimand_binary</span> <span class="o">=</span> <span class="n">model_binary</span><span class="o">.</span><span class="n">identify_effect</span><span class="p">(</span><span class="n">proceed_when_unidentifiable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_model:Model to find the causal effect of treatment [&#39;v0&#39;] on outcome [&#39;y&#39;]
INFO:dowhy.causal_identifier:Common causes of treatment and outcome:[&#39;W1&#39;, &#39;Unobserved Confounders&#39;, &#39;W2&#39;, &#39;W0&#39;, &#39;W3&#39;]
WARNING:dowhy.causal_identifier:If this is observed data (not from a randomized experiment), there might always be missing confounders. Causal effect cannot be identified perfectly.
INFO:dowhy.causal_identifier:Continuing by ignoring these unobserved confounders because proceed_when_unidentifiable flag is True.
INFO:dowhy.causal_identifier:Instrumental variables for treatment and outcome:[&#39;Z1&#39;, &#39;Z0&#39;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
            X0        X1   Z0        Z1        W0        W1        W2  \
0    -0.244034  0.446110  1.0  0.150036  0.031920 -1.625521  0.492200
1    -0.164687  1.328317  0.0  0.989014  1.323418 -1.154542 -0.914339
2     0.679963  1.753415  1.0  0.934362  0.503141  0.535458 -0.293091
3    -1.313644  0.224602  1.0  0.214924  2.634988 -0.882465  0.824165
4    -0.891239  0.099729  0.0  0.114274  1.524771 -0.828252  0.547597
...        ...       ...  ...       ...       ...       ...       ...
9995 -1.378322 -1.017110  1.0  0.003541 -0.121519 -1.502455  0.220122
9996  0.630535  2.623948  1.0  0.049953  0.069589 -0.781693 -1.115547
9997  0.477717 -0.907630  1.0  0.410879  0.389917  0.593414 -0.039885
9998 -0.817759  1.100888  1.0  0.809273  1.338075 -0.624080  1.482259
9999 -0.637273  0.893261  1.0  0.390162  0.207668 -0.926990  0.399456

            W3     v0      y
0     0.704523   True  False
1     1.670159   True  False
2     2.018846   True   True
3     2.732900   True  False
4     0.166685   True   True
...        ...    ...    ...
9995  0.207060  False  False
9996  2.204513   True   True
9997 -0.206020   True   True
9998  3.709620   True   True
9999  1.714626   True  False

[10000 rows x 10 columns]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DRLearner</span> <span class="n">throws</span> <span class="n">an</span> <span class="n">error</span> <span class="n">since</span> <span class="n">it</span> <span class="n">expects</span> <span class="n">the</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">a</span> <span class="mi">1</span><span class="o">-</span><span class="n">D</span> <span class="n">array</span><span class="o">.</span> <span class="n">This</span> <span class="n">will</span> <span class="n">be</span> <span class="n">fixed</span> <span class="n">soon</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">EconML</span> <span class="n">package</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegressionCV</span>
<span class="c1">#todo needs binary y</span>
<span class="n">drlearner_estimate</span> <span class="o">=</span> <span class="n">model_binary</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span><span class="n">identified_estimand_binary</span><span class="p">,</span>
                                <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;backdoor.econml.drlearner.LinearDRLearner&quot;</span><span class="p">,</span>
                                <span class="n">target_units</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;X0&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">confidence_intervals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;init_params&quot;</span><span class="p">:{</span>
                                                    <span class="s1">&#39;model_propensity&#39;</span><span class="p">:</span> <span class="n">LogisticRegressionCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
                                                    <span class="p">},</span>
                                               <span class="s2">&quot;fit_params&quot;</span><span class="p">:{}</span>
                                              <span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">drlearner_estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_estimator:INFO: Using EconML Estimator
INFO:dowhy.causal_estimator:b: y~v0+W1+W2+W0+W3
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-16-f77b6b495b1d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span>                                                     <span class="ansi-blue-fg">&#39;model_propensity&#39;</span><span class="ansi-blue-fg">:</span> LogisticRegressionCV<span class="ansi-blue-fg">(</span>cv<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">,</span> solver<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;lbfgs&#39;</span><span class="ansi-blue-fg">,</span> multi_class<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;auto&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>                                                     },
<span class="ansi-green-fg">---&gt; 10</span><span class="ansi-red-fg">                                                </span><span class="ansi-blue-fg">&#34;fit_params&#34;</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">}</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>                                               })
<span class="ansi-green-intense-fg ansi-bold">     12</span> print<span class="ansi-blue-fg">(</span>drlearner_estimate<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_model.py</span> in <span class="ansi-cyan-fg">estimate_effect</span><span class="ansi-blue-fg">(self, identified_estimand, method_name, control_value, treatment_value, test_significance, evaluate_effect_strength, confidence_intervals, target_units, effect_modifiers, method_params)</span>
<span class="ansi-green-intense-fg ansi-bold">    205</span>                 params<span class="ansi-blue-fg">=</span>method_params
<span class="ansi-green-intense-fg ansi-bold">    206</span>             )
<span class="ansi-green-fg">--&gt; 207</span><span class="ansi-red-fg">             </span>estimate <span class="ansi-blue-fg">=</span> causal_estimator<span class="ansi-blue-fg">.</span>estimate_effect<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    208</span>             <span class="ansi-red-fg"># Store parameters inside estimate object for refutation methods</span>
<span class="ansi-green-intense-fg ansi-bold">    209</span>             estimate.add_params(

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimator.py</span> in <span class="ansi-cyan-fg">estimate_effect</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">     85</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">     86</span>
<span class="ansi-green-fg">---&gt; 87</span><span class="ansi-red-fg">         </span>est <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_estimate_effect<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     88</span>         self<span class="ansi-blue-fg">.</span>_estimate <span class="ansi-blue-fg">=</span> est
<span class="ansi-green-intense-fg ansi-bold">     89</span>

<span class="ansi-green-fg">/mnt/c/Users/amshar/code/dowhy/dowhy/causal_estimators/econml_cate_estimator.py</span> in <span class="ansi-cyan-fg">_estimate_effect</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">     66</span>         <span class="ansi-red-fg"># Calling the econml estimator&#39;s fit method</span>
<span class="ansi-green-intense-fg ansi-bold">     67</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>identifier_method <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#34;backdoor&#34;</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 68</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>estimator<span class="ansi-blue-fg">.</span>fit<span class="ansi-blue-fg">(</span>Y<span class="ansi-blue-fg">,</span> T<span class="ansi-blue-fg">,</span> X<span class="ansi-blue-fg">,</span> W<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>self<span class="ansi-blue-fg">.</span>method_params<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;fit_params&#34;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     69</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     70</span>             self<span class="ansi-blue-fg">.</span>estimator<span class="ansi-blue-fg">.</span>fit<span class="ansi-blue-fg">(</span>Y<span class="ansi-blue-fg">,</span> T<span class="ansi-blue-fg">,</span> X<span class="ansi-blue-fg">,</span> Z<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>self<span class="ansi-blue-fg">.</span>method_params<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;fit_params&#34;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/python-environments/vpy36/lib/python3.6/site-packages/econml/drlearner.py</span> in <span class="ansi-cyan-fg">fit</span><span class="ansi-blue-fg">(self, Y, T, X, W, sample_weight, sample_var, inference)</span>
<span class="ansi-green-intense-fg ansi-bold">    656</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    657</span>         <span class="ansi-red-fg"># Replacing fit from DRLearner, to add statsmodels inference in docstring</span>
<span class="ansi-green-fg">--&gt; 658</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>fit<span class="ansi-blue-fg">(</span>Y<span class="ansi-blue-fg">,</span> T<span class="ansi-blue-fg">,</span> X<span class="ansi-blue-fg">=</span>X<span class="ansi-blue-fg">,</span> W<span class="ansi-blue-fg">=</span>W<span class="ansi-blue-fg">,</span> sample_weight<span class="ansi-blue-fg">=</span>sample_weight<span class="ansi-blue-fg">,</span> sample_var<span class="ansi-blue-fg">=</span>sample_var<span class="ansi-blue-fg">,</span> inference<span class="ansi-blue-fg">=</span>inference<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    659</span>
<span class="ansi-green-intense-fg ansi-bold">    660</span>     <span class="ansi-blue-fg">@</span>property

<span class="ansi-green-fg">~/python-environments/vpy36/lib/python3.6/site-packages/econml/drlearner.py</span> in <span class="ansi-cyan-fg">fit</span><span class="ansi-blue-fg">(self, Y, T, X, W, sample_weight, sample_var, inference)</span>
<span class="ansi-green-intense-fg ansi-bold">    364</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    365</span>         <span class="ansi-red-fg"># Replacing fit from _OrthoLearner, to enforce Z=None and improve the docstring</span>
<span class="ansi-green-fg">--&gt; 366</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>fit<span class="ansi-blue-fg">(</span>Y<span class="ansi-blue-fg">,</span> T<span class="ansi-blue-fg">,</span> X<span class="ansi-blue-fg">=</span>X<span class="ansi-blue-fg">,</span> W<span class="ansi-blue-fg">=</span>W<span class="ansi-blue-fg">,</span> sample_weight<span class="ansi-blue-fg">=</span>sample_weight<span class="ansi-blue-fg">,</span> sample_var<span class="ansi-blue-fg">=</span>sample_var<span class="ansi-blue-fg">,</span> inference<span class="ansi-blue-fg">=</span>inference<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    367</span>
<span class="ansi-green-intense-fg ansi-bold">    368</span>     <span class="ansi-green-fg">def</span> score<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> Y<span class="ansi-blue-fg">,</span> T<span class="ansi-blue-fg">,</span> X<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> W<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/python-environments/vpy36/lib/python3.6/site-packages/econml/cate_estimator.py</span> in <span class="ansi-cyan-fg">call</span><span class="ansi-blue-fg">(self, Y, T, inference, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     87</span>                 inference<span class="ansi-blue-fg">.</span>prefit<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> Y<span class="ansi-blue-fg">,</span> T<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     88</span>             <span class="ansi-red-fg"># call the wrapped fit method</span>
<span class="ansi-green-fg">---&gt; 89</span><span class="ansi-red-fg">             </span>m<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> Y<span class="ansi-blue-fg">,</span> T<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     90</span>             <span class="ansi-green-fg">if</span> inference <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     91</span>                 <span class="ansi-red-fg"># NOTE: we call inference fit *after* calling the main fit method</span>

<span class="ansi-green-fg">~/python-environments/vpy36/lib/python3.6/site-packages/econml/_ortho_learner.py</span> in <span class="ansi-cyan-fg">fit</span><span class="ansi-blue-fg">(self, Y, T, X, W, Z, sample_weight, sample_var, inference)</span>
<span class="ansi-green-intense-fg ansi-bold">    478</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    479</span>         self<span class="ansi-blue-fg">.</span>_check_input_dims<span class="ansi-blue-fg">(</span>Y<span class="ansi-blue-fg">,</span> T<span class="ansi-blue-fg">,</span> X<span class="ansi-blue-fg">,</span> W<span class="ansi-blue-fg">,</span> Z<span class="ansi-blue-fg">,</span> sample_weight<span class="ansi-blue-fg">,</span> sample_var<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 480</span><span class="ansi-red-fg">         </span>nuisances<span class="ansi-blue-fg">,</span> fitted_inds <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_fit_nuisances<span class="ansi-blue-fg">(</span>Y<span class="ansi-blue-fg">,</span> T<span class="ansi-blue-fg">,</span> X<span class="ansi-blue-fg">,</span> W<span class="ansi-blue-fg">,</span> Z<span class="ansi-blue-fg">,</span> sample_weight<span class="ansi-blue-fg">=</span>sample_weight<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    481</span>         self._fit_final(self._subinds_check_none(Y, fitted_inds),
<span class="ansi-green-intense-fg ansi-bold">    482</span>                         self<span class="ansi-blue-fg">.</span>_subinds_check_none<span class="ansi-blue-fg">(</span>T<span class="ansi-blue-fg">,</span> fitted_inds<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/python-environments/vpy36/lib/python3.6/site-packages/econml/_ortho_learner.py</span> in <span class="ansi-cyan-fg">_fit_nuisances</span><span class="ansi-blue-fg">(self, Y, T, X, W, Z, sample_weight)</span>
<span class="ansi-green-intense-fg ansi-bold">    516</span>
<span class="ansi-green-intense-fg ansi-bold">    517</span>         nuisances, fitted_models, fitted_inds = _crossfit(self._model_nuisance, folds,
<span class="ansi-green-fg">--&gt; 518</span><span class="ansi-red-fg">                                                           Y, T, X=X, W=W, Z=Z, sample_weight=sample_weight)
</span><span class="ansi-green-intense-fg ansi-bold">    519</span>         self<span class="ansi-blue-fg">.</span>_models_nuisance <span class="ansi-blue-fg">=</span> fitted_models
<span class="ansi-green-intense-fg ansi-bold">    520</span>         <span class="ansi-green-fg">return</span> nuisances<span class="ansi-blue-fg">,</span> fitted_inds

<span class="ansi-green-fg">~/python-environments/vpy36/lib/python3.6/site-packages/econml/_ortho_learner.py</span> in <span class="ansi-cyan-fg">_crossfit</span><span class="ansi-blue-fg">(model, folds, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    143</span>                 kwargs_test<span class="ansi-blue-fg">[</span>key<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> var<span class="ansi-blue-fg">[</span>test_idxs<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    144</span>
<span class="ansi-green-fg">--&gt; 145</span><span class="ansi-red-fg">         </span>model_list<span class="ansi-blue-fg">[</span>idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>fit<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args_train<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs_train<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    146</span>
<span class="ansi-green-intense-fg ansi-bold">    147</span>         nuisance_temp <span class="ansi-blue-fg">=</span> model_list<span class="ansi-blue-fg">[</span>idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>predict<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args_test<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs_test<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/python-environments/vpy36/lib/python3.6/site-packages/econml/drlearner.py</span> in <span class="ansi-cyan-fg">fit</span><span class="ansi-blue-fg">(self, Y, T, X, W, sample_weight)</span>
<span class="ansi-green-intense-fg ansi-bold">    260</span>             <span class="ansi-green-fg">def</span> fit<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> Y<span class="ansi-blue-fg">,</span> T<span class="ansi-blue-fg">,</span> X<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> W<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span><span class="ansi-blue-fg">,</span> sample_weight<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    261</span>                 <span class="ansi-red-fg"># TODO Allow for non-vector y, i.e. of shape (n, 1)</span>
<span class="ansi-green-fg">--&gt; 262</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">assert</span> np<span class="ansi-blue-fg">.</span>ndim<span class="ansi-blue-fg">(</span>Y<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">==</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;Can only accept single dimensional outcomes Y! Use Y.ravel().&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">    263</span>                 <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">(</span>X <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">and</span> <span class="ansi-blue-fg">(</span>W <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    264</span>                     <span class="ansi-green-fg">raise</span> AttributeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;At least one of X or W has to not be None!&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">AssertionError</span>: Can only accept single dimensional outcomes Y! Use Y.ravel().
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">keras</span>
<span class="kn">from</span> <span class="nn">econml.deepiv</span> <span class="kn">import</span> <span class="n">DeepIVEstimator</span>
<span class="n">dims_zx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_instruments</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_effect_modifiers</span><span class="p">)</span>
<span class="n">dims_tx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_treatment</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_effect_modifiers</span><span class="p">)</span>
<span class="n">treatment_model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">dims_zx</span><span class="p">,)),</span> <span class="c1"># sum of dims of Z and X</span>
                                    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.17</span><span class="p">),</span>
                                    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
                                    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.17</span><span class="p">),</span>
                                    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
                                    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.17</span><span class="p">)])</span>
<span class="n">response_model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">dims_tx</span><span class="p">,)),</span> <span class="c1"># sum of dims of T and X</span>
                                    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.17</span><span class="p">),</span>
                                    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
                                    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.17</span><span class="p">),</span>
                                    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
                                    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.17</span><span class="p">),</span>
                                    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span>

<span class="n">deepiv_estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">,</span>
                                        <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;iv.econml.deepiv.DeepIVEstimator&quot;</span><span class="p">,</span>
                                        <span class="n">target_units</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;X0&quot;</span><span class="p">]</span><span class="o">&gt;-</span><span class="mi">1</span><span class="p">,</span>
                                        <span class="n">confidence_intervals</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">method_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;init_params&quot;</span><span class="p">:{</span><span class="s1">&#39;n_components&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="c1"># Number of gaussians in the mixture density networks</span>
                                                              <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">treatment_model</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">])),</span> <span class="c1"># Treatment model,</span>
                                                              <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">response_model</span><span class="p">(</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">])),</span> <span class="c1"># Response model</span>
                                                              <span class="s1">&#39;n_samples&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1"># Number of samples used to estimate the response</span>
                                                              <span class="s1">&#39;first_stage_options&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span><span class="mi">25</span><span class="p">},</span>
                                                              <span class="s1">&#39;second_stage_options&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;epochs&#39;</span><span class="p">:</span><span class="mi">25</span><span class="p">}</span>
                                                             <span class="p">},</span>
                                               <span class="s2">&quot;fit_params&quot;</span><span class="p">:{}})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">deepiv_estimate</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Using TensorFlow backend.
INFO:dowhy.causal_estimator:INFO: Using EconML Estimator
INFO:dowhy.causal_estimator:b: y~v0+W1+W2+W0+W3
WARNING:tensorflow:From /home/amshar/python-environments/vpy36/lib/python3.6/site-packages/tensorflow/python/ops/math_ops.py:2403: add_dispatch_support.&lt;locals&gt;.wrapper (from tensorflow.python.ops.array_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.where in 2.0, which has the same broadcast rule as np.where
WARNING:tensorflow:From /home/amshar/python-environments/vpy36/lib/python3.6/site-packages/keras/backend/tensorflow_backend.py:422: The name tf.global_variables is deprecated. Please use tf.compat.v1.global_variables instead.

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/25
10000/10000 [==============================] - 1s 124us/step - loss: 4.4319
Epoch 2/25
10000/10000 [==============================] - 1s 75us/step - loss: 2.5738
Epoch 3/25
10000/10000 [==============================] - 1s 73us/step - loss: 2.4952
Epoch 4/25
10000/10000 [==============================] - 1s 71us/step - loss: 2.4641
Epoch 5/25
10000/10000 [==============================] - 1s 71us/step - loss: 2.4457
Epoch 6/25
10000/10000 [==============================] - 1s 70us/step - loss: 2.4316
Epoch 7/25
10000/10000 [==============================] - 1s 68us/step - loss: 2.4209
Epoch 8/25
10000/10000 [==============================] - 1s 67us/step - loss: 2.4129
Epoch 9/25
10000/10000 [==============================] - 1s 68us/step - loss: 2.4118
Epoch 10/25
10000/10000 [==============================] - 1s 67us/step - loss: 2.3970
Epoch 11/25
10000/10000 [==============================] - 1s 68us/step - loss: 2.3927
Epoch 12/25
10000/10000 [==============================] - 1s 67us/step - loss: 2.3847
Epoch 13/25
10000/10000 [==============================] - 1s 68us/step - loss: 2.3744
Epoch 14/25
10000/10000 [==============================] - 1s 68us/step - loss: 2.3734
Epoch 15/25
10000/10000 [==============================] - 1s 68us/step - loss: 2.3703
Epoch 16/25
10000/10000 [==============================] - 1s 68us/step - loss: 2.3703
Epoch 17/25
10000/10000 [==============================] - 1s 67us/step - loss: 2.3687
Epoch 18/25
10000/10000 [==============================] - 1s 68us/step - loss: 2.3656
Epoch 19/25
10000/10000 [==============================] - 1s 68us/step - loss: 2.3637
Epoch 20/25
10000/10000 [==============================] - 1s 67us/step - loss: 2.3660
Epoch 21/25
10000/10000 [==============================] - 1s 67us/step - loss: 2.3649
Epoch 22/25
10000/10000 [==============================] - 1s 67us/step - loss: 2.3605
Epoch 23/25
10000/10000 [==============================] - 1s 67us/step - loss: 2.3604
Epoch 24/25
10000/10000 [==============================] - 1s 67us/step - loss: 2.3613
Epoch 25/25
10000/10000 [==============================] - 1s 67us/step - loss: 2.3563
Epoch 1/25
10000/10000 [==============================] - 2s 158us/step - loss: 5949.5935
Epoch 2/25
10000/10000 [==============================] - 1s 98us/step - loss: 4743.4237
Epoch 3/25
10000/10000 [==============================] - 1s 98us/step - loss: 4587.5153
Epoch 4/25
10000/10000 [==============================] - 1s 98us/step - loss: 4517.5050
Epoch 5/25
10000/10000 [==============================] - 1s 98us/step - loss: 4555.7044
Epoch 6/25
10000/10000 [==============================] - 1s 97us/step - loss: 4534.2699
Epoch 7/25
10000/10000 [==============================] - 1s 97us/step - loss: 4529.3596
Epoch 8/25
10000/10000 [==============================] - 1s 97us/step - loss: 4497.4663
Epoch 9/25
10000/10000 [==============================] - 1s 97us/step - loss: 4531.7572
Epoch 10/25
10000/10000 [==============================] - 1s 97us/step - loss: 4515.4579
Epoch 11/25
10000/10000 [==============================] - 1s 97us/step - loss: 4500.4461
Epoch 12/25
10000/10000 [==============================] - 1s 97us/step - loss: 4532.0580
Epoch 13/25
10000/10000 [==============================] - 1s 96us/step - loss: 4517.4350
Epoch 14/25
10000/10000 [==============================] - 1s 98us/step - loss: 4526.6062
Epoch 15/25
10000/10000 [==============================] - 1s 97us/step - loss: 4510.8721
Epoch 16/25
10000/10000 [==============================] - 1s 97us/step - loss: 4503.3059
Epoch 17/25
10000/10000 [==============================] - 1s 95us/step - loss: 4504.0826
Epoch 18/25
10000/10000 [==============================] - 1s 94us/step - loss: 4496.8913
Epoch 19/25
10000/10000 [==============================] - 1s 94us/step - loss: 4498.4330
Epoch 20/25
10000/10000 [==============================] - 1s 94us/step - loss: 4522.1410
Epoch 21/25
10000/10000 [==============================] - 1s 94us/step - loss: 4489.7271
Epoch 22/25
10000/10000 [==============================] - 1s 95us/step - loss: 4524.5314
Epoch 23/25
10000/10000 [==============================] - 1s 94us/step - loss: 4501.4307
Epoch 24/25
10000/10000 [==============================] - 1s 94us/step - loss: 4498.6122
Epoch 25/25
10000/10000 [==============================] - 1s 94us/step - loss: 4519.7218
*** Causal Estimate ***

## Target estimand
Estimand type: nonparametric-ate
### Estimand : 1
Estimand name: backdoor
Estimand expression:
  d
─────(Expectation(y|W1,W2,W0,W3))
d[v₀]
Estimand assumption 1, Unconfoundedness: If U→{v0} and U→y then P(y|v0,W1,W2,W0,W3,U) = P(y|v0,W1,W2,W0,W3)
### Estimand : 2
Estimand name: iv
Estimand expression:
Expectation(Derivative(y, [Z1, Z0])*Derivative([v0], [Z1, Z0])**(-1))
Estimand assumption 1, As-if-random: If U→→y then ¬(U →→{Z1,Z0})
Estimand assumption 2, Exclusion: If we remove {Z1,Z0}→{v0}, then ¬({Z1,Z0}→y)

## Realized estimand
b: y~v0+W1+W2+W0+W3
## Estimate
Value: 1.3551253080368042

</pre></div></div>
</div>
</div>
<div class="section" id="Refuting-the-estimate">
<h1>Refuting the estimate<a class="headerlink" href="#Refuting-the-estimate" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Random">
<h2>Random<a class="headerlink" href="#Random" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">res_random</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">refute_estimate</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">,</span> <span class="n">dml_estimate</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;random_common_cause&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_random</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_estimator:INFO: Using EconML Estimator
INFO:dowhy.causal_estimator:b: y~v0+W1+W2+W0+W3+w_random
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Refute: Add a Random Common Cause
Estimated effect:(11.347542921584203,)
New effect:(12.30817693056707,)

</pre></div></div>
</div>
</div>
<div class="section" id="Adding-an-unobserved-common-cause-variable">
<h2>Adding an unobserved common cause variable<a class="headerlink" href="#Adding-an-unobserved-common-cause-variable" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">res_unobserved</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">refute_estimate</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">,</span> <span class="n">dml_estimate</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;add_unobserved_common_cause&quot;</span><span class="p">,</span>
                                     <span class="n">confounders_effect_on_treatment</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">confounders_effect_on_outcome</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
                                    <span class="n">effect_strength_on_treatment</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">effect_strength_on_outcome</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_unobserved</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_estimator:INFO: Using EconML Estimator
INFO:dowhy.causal_estimator:b: y~v0+W1+W2+W0+W3
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Refute: Add an Unobserved Common Cause
Estimated effect:(11.347542921584203,)
New effect:(12.338650697854053,)

</pre></div></div>
</div>
</div>
<div class="section" id="Replacing-treatment-with-a-random-(placebo)-variable">
<h2>Replacing treatment with a random (placebo) variable<a class="headerlink" href="#Replacing-treatment-with-a-random-(placebo)-variable" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">res_placebo</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">refute_estimate</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">,</span> <span class="n">dml_estimate</span><span class="p">,</span>
        <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;placebo_treatment_refuter&quot;</span><span class="p">,</span> <span class="n">placebo_type</span><span class="o">=</span><span class="s2">&quot;permute&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_placebo</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_estimator:INFO: Using EconML Estimator
INFO:dowhy.causal_estimator:b: y~placebo+W1+W2+W0+W3
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Refute: Use a Placebo Treatment
Estimated effect:(11.347542921584203,)
New effect:(0.0,)

</pre></div></div>
</div>
</div>
<div class="section" id="Removing-a-random-subset-of-the-data">
<h2>Removing a random subset of the data<a class="headerlink" href="#Removing-a-random-subset-of-the-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">res_subset</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">refute_estimate</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">,</span> <span class="n">dml_estimate</span><span class="p">,</span>
        <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;data_subset_refuter&quot;</span><span class="p">,</span> <span class="n">subset_fraction</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res_subset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:dowhy.causal_estimator:INFO: Using EconML Estimator
INFO:dowhy.causal_estimator:b: y~v0+W1+W2+W0+W3
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Refute: Use a subset of data
Estimated effect:(11.347542921584203,)
New effect:(12.363953363725717,)

</pre></div></div>
</div>
<p>More refutation methods to come, especially specific to the CATE estimators.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Microsoft

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>